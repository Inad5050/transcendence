services:
  nginx:
    build: ./nginx
    image: nginx
    container_name: nginx
    ports:
      - "8085:80"
      - "8086:443"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./backend/www:/var/www/html/www
    networks: default
    depends_on:
      backend:
        condition: service_healthy
      frontend:
        condition: service_healthy
      game:
        condition: service_healthy

  backend:
    build: ./backend
    image: backend
    container_name: backend
    volumes:
      - ./backend/www:/var/www/html/www
      - ./backend/database:/var/www/html/database
      - ./backend/vendor:/var/www/html/vendor
    expose:
      - "${BACKEND_PORT:-9000}"
    environment:
      - APP_ENV=${ENV:-development}
      - APP_DEBUG=${APP_DEBUG:-true}
      - DB_DATABASE=/var/www/database/database.sqlite
      - APP_KEY=${APP_KEY}
      - JWTsecretKey=${JWTsecretKey}
    networks: 
      - default

  frontend:
    build: ./frontend
    image: frontend
    container_name: frontend

    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports: 
      - "3000:3000"
    networks: 
      - default

  game:
    build: ./game
    image: game
    container_name: game

    container_name: transcendence-frontend
    volumes:
      - ./frontend:/app
      - /app/node_modules
    ports: 
      - "3000:3000"
    networks: 
      - default
    
networks:
  default:
    name: net-transcendence
    driver: bridge
